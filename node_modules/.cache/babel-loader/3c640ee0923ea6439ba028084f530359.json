{"ast":null,"code":"import _classCallCheck from \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/src/containers/App/index.js\";\nimport React, { Component } from 'react';\nimport { Route, Redirect, Switch } from 'react-router-dom';\nimport NavBar from '../../components/Navbar';\nimport LoginForm from '../../components/LoginForm';\nimport NewUserForm from '../../components/NewUserForm';\nimport Main from '../Main';\nimport OrderForm from '../../components/OrderForm';\nimport { baseUrl } from '../../constants';\nimport { styled } from 'styletron-react';\nimport styles from './styles.js';\nvar MainContainer = styled('div', styles.main);\nvar Content = styled('div', styles.content);\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(App)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      error: '',\n      orders: []\n    };\n\n    _this.handleCreateUser = function (e) {\n      e.preventDefault();\n      var data = {\n        user: {\n          first_name: e.currentTarget.first_name.value,\n          last_name: e.currentTarget.last_name.value,\n          username: e.currentTarget.username.value,\n          email: e.currentTarget.email.value,\n          password: e.currentTarget.password.value\n        }\n      };\n      fetch(baseUrl + '/users', {\n        method: 'POST',\n        body: JSON.stringify(data),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }).then(function (response) {\n        return response.json();\n      }).then(function (newUser) {\n        if (newUser.errors) {\n          _this.displayErrors(newUser.errors);\n        } else {\n          if (newUser.success) {\n            localStorage.setItem('token', newUser.token);\n\n            _this.setState({\n              error: ''\n            });\n          }\n\n          window.history.back();\n        }\n      });\n    };\n\n    _this.displayErrors = function (errors) {\n      var errorlist = errors.map(function (error) {\n        return \"-\".concat(error, \" \\n\");\n      });\n      alert(errorlist.join(' '));\n    };\n\n    _this.handleLogin = function (e) {\n      e.preventDefault();\n      var params = {\n        username: e.currentTarget.username.value,\n        password: e.currentTarget.password.value\n      };\n\n      _this.setState({\n        error: ''\n      });\n\n      fetch(baseUrl + '/login', {\n        method: 'POST',\n        body: JSON.stringify(params),\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json'\n        }\n      }).then(function (res) {\n        return res.json();\n      }).then(function (data) {\n        console.log('TCL: App -> data', data);\n\n        if (data.success) {\n          localStorage.setItem('token', data.token);\n\n          _this.setState({\n            error: ''\n          });\n\n          window.history.back();\n        } else {\n          _this.setState({\n            error: 'Invalid username or password'\n          });\n\n          alert('Invalid username or password');\n        }\n      });\n    };\n\n    _this.handleLogout = function () {\n      localStorage.clear();\n      window.history.back();\n    };\n\n    _this.handlePlaceOrder = function (orderItems, address) {\n      console.log('TCL: App -> handlePlaceOrder -> address', address);\n      var fullOrder = {\n        order: {\n          order_items: orderItems.map(function (orderItem) {\n            return {\n              pizza_type_id: orderItem.pizza_type_id,\n              quantity: orderItem.quantity\n            };\n          }),\n          date_time: new Date(),\n          address_id: address.id\n        }\n      };\n      var token = localStorage.getItem('token');\n\n      if (token) {\n        fetch(baseUrl + '/orders', {\n          method: 'POST',\n          body: JSON.stringify(fullOrder),\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: \"Bearer \".concat(token)\n          }\n        }).then(function (res) {\n          return res.json();\n        }).then(function (orderResponse) {\n          console.log('TCL: App -> order', orderResponse);\n          var localOrders = _this.state.orders;\n          var updatedOrders = localOrders.push(orderResponse);\n\n          _this.setState({\n            updatedOrders: updatedOrders\n          });\n        });\n      }\n    };\n\n    _this.handleCancelOrder = function () {};\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var token = localStorage.getItem('token');\n\n      if (token) {\n        fetch(baseUrl + '/orders', {\n          headers: {\n            Authorization: \"Bearer \".concat(token)\n          }\n        }).then(function (res) {\n          return res.json();\n        }).then(function (orders) {\n          console.log(orders);\n\n          _this2.setState({\n            orders: orders\n          });\n        }).catch(function (e) {\n          return console.error(e);\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          orders = _this$state.orders,\n          error = _this$state.error;\n      console.log(window.location.href.includes('login')); // if (\n      //   localStorage.getItem('token') &&\n      //   window.location.href.includes('login')\n      // ) {\n      //   return <Redirect to=\"/\" />\n      // }\n\n      return React.createElement(MainContainer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }, React.createElement(NavBar, {\n        handleLogin: this.handleLogin,\n        handleLogout: this.handleLogout,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }), React.createElement(Content, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, React.createElement(Route, {\n        exact: true,\n        path: \"/new_user\",\n        render: function render(routerProps) {\n          return React.createElement(NewUserForm, {\n            handleCreateOrEditUser: _this3.handleCreateUser,\n            displayNewUserForm: _this3.state.displayNewUserForm,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 176\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      }), localStorage.getItem('token') ? null : React.createElement(Route, {\n        exact: true,\n        path: \"/login\",\n        render: function render(routerProps) {\n          return React.createElement(LoginForm, {\n            createNewUser: _this3.createNewUser,\n            handleLogin: _this3.handleLogin,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 187\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }), localStorage.getItem('token') ? React.createElement(React.Fragment, null, React.createElement(Route, {\n        exact: true,\n        path: \"/\",\n        render: function render(routerProps) {\n          return React.createElement(Main, {\n            orders: orders,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 199\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }), React.createElement(Route, {\n        path: \"/place-order\",\n        render: function render(routerProps) {\n          return React.createElement(OrderForm, {\n            handlePlaceOrder: _this3.handlePlaceOrder,\n            handleCancelOrder: _this3.handleCancelOrder,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 204\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      })) : null));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/src/containers/App/index.js"],"names":["React","Component","Route","Redirect","Switch","NavBar","LoginForm","NewUserForm","Main","OrderForm","baseUrl","styled","styles","MainContainer","main","Content","content","App","state","error","orders","handleCreateUser","e","preventDefault","data","user","first_name","currentTarget","value","last_name","username","email","password","fetch","method","body","JSON","stringify","headers","then","response","json","newUser","errors","displayErrors","success","localStorage","setItem","token","setState","window","history","back","errorlist","map","alert","join","handleLogin","params","Accept","res","console","log","handleLogout","clear","handlePlaceOrder","orderItems","address","fullOrder","order","order_items","orderItem","pizza_type_id","quantity","date_time","Date","address_id","id","getItem","Authorization","orderResponse","localOrders","updatedOrders","push","handleCancelOrder","catch","location","href","includes","routerProps","displayNewUserForm","createNewUser"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Route, Redirect, Switch } from 'react-router-dom'\nimport NavBar from '../../components/Navbar'\nimport LoginForm from '../../components/LoginForm'\nimport NewUserForm from '../../components/NewUserForm'\nimport Main from '../Main'\nimport OrderForm from '../../components/OrderForm'\nimport { baseUrl } from '../../constants'\nimport { styled } from 'styletron-react'\nimport styles from './styles.js'\n\nconst MainContainer = styled('div', styles.main)\nconst Content = styled('div', styles.content)\n\nclass App extends Component {\n  state = { error: '', orders: [] }\n\n  componentDidMount() {\n    let token = localStorage.getItem('token')\n    if (token) {\n      fetch(baseUrl + '/orders', {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      })\n        .then(res => res.json())\n        .then(orders => {\n          console.log(orders)\n          this.setState({ orders })\n        })\n        .catch(e => console.error(e))\n    }\n  }\n\n  handleCreateUser = e => {\n    e.preventDefault()\n\n    let data = {\n      user: {\n        first_name: e.currentTarget.first_name.value,\n        last_name: e.currentTarget.last_name.value,\n        username: e.currentTarget.username.value,\n        email: e.currentTarget.email.value,\n        password: e.currentTarget.password.value\n      }\n    }\n\n    fetch(baseUrl + '/users', {\n      method: 'POST',\n      body: JSON.stringify(data),\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    })\n      .then(response => response.json())\n      .then(newUser => {\n        if (newUser.errors) {\n          this.displayErrors(newUser.errors)\n        } else {\n          if (newUser.success) {\n            localStorage.setItem('token', newUser.token)\n\n            this.setState({\n              error: ''\n            })\n          }\n          window.history.back()\n        }\n      })\n  }\n\n  displayErrors = errors => {\n    let errorlist = errors.map(error => {\n      return `-${error} \\n`\n    })\n    alert(errorlist.join(' '))\n  }\n\n  handleLogin = e => {\n    e.preventDefault()\n    const params = {\n      username: e.currentTarget.username.value,\n      password: e.currentTarget.password.value\n    }\n\n    this.setState({ error: '' })\n\n    fetch(baseUrl + '/login', {\n      method: 'POST',\n      body: JSON.stringify(params),\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json'\n      }\n    })\n      .then(res => res.json())\n      .then(data => {\n        console.log('TCL: App -> data', data)\n        if (data.success) {\n          localStorage.setItem('token', data.token)\n\n          this.setState({ error: '' })\n          window.history.back()\n        } else {\n          this.setState({ error: 'Invalid username or password' })\n          alert('Invalid username or password')\n        }\n      })\n  }\n\n  handleLogout = () => {\n    localStorage.clear()\n    window.history.back()\n  }\n\n  handlePlaceOrder = (orderItems, address) => {\n    console.log('TCL: App -> handlePlaceOrder -> address', address)\n    const fullOrder = {\n      order: {\n        order_items: orderItems.map(orderItem => {\n          return {\n            pizza_type_id: orderItem.pizza_type_id,\n            quantity: orderItem.quantity\n          }\n        }),\n        date_time: new Date(),\n        address_id: address.id\n      }\n    }\n\n    let token = localStorage.getItem('token')\n    if (token) {\n      fetch(baseUrl + '/orders', {\n        method: 'POST',\n        body: JSON.stringify(fullOrder),\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        }\n      })\n        .then(res => res.json())\n        .then(orderResponse => {\n          console.log('TCL: App -> order', orderResponse)\n          const localOrders = this.state.orders\n          const updatedOrders = localOrders.push(orderResponse)\n          this.setState({ updatedOrders })\n        })\n    }\n  }\n\n  handleCancelOrder = () => {}\n\n  render() {\n    const { orders, error } = this.state\n    console.log(window.location.href.includes('login'))\n\n    // if (\n    //   localStorage.getItem('token') &&\n    //   window.location.href.includes('login')\n    // ) {\n    //   return <Redirect to=\"/\" />\n    // }\n\n    return (\n      <MainContainer>\n        <NavBar\n          handleLogin={this.handleLogin}\n          handleLogout={this.handleLogout}\n        />\n\n        <Content>\n          <Route\n            exact\n            path=\"/new_user\"\n            render={routerProps => (\n              <NewUserForm\n                handleCreateOrEditUser={this.handleCreateUser}\n                displayNewUserForm={this.state.displayNewUserForm}\n              />\n            )}\n          />\n          {localStorage.getItem('token') ? null : (\n            <Route\n              exact\n              path=\"/login\"\n              render={routerProps => (\n                <LoginForm\n                  createNewUser={this.createNewUser}\n                  handleLogin={this.handleLogin}\n                />\n              )}\n            />\n          )}\n          {localStorage.getItem('token') ? (\n            <>\n              <Route\n                exact\n                path=\"/\"\n                render={routerProps => <Main orders={orders} />}\n              />\n              <Route\n                path=\"/place-order\"\n                render={routerProps => (\n                  <OrderForm\n                    handlePlaceOrder={this.handlePlaceOrder}\n                    handleCancelOrder={this.handleCancelOrder}\n                  />\n                )}\n              />\n            </>\n          ) : null}\n        </Content>\n      </MainContainer>\n    )\n  }\n}\n\nexport default App\n"]},"metadata":{},"sourceType":"module"}