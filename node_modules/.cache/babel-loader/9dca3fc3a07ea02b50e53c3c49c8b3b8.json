{"ast":null,"code":"import _classCallCheck from \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/src/containers/App/index.js\";\nimport React, { Component } from 'react';\nimport { Route } from 'react-router-dom';\nimport NavBar from '../../components/Navbar';\nimport LoginForm from '../../components/LoginForm';\nimport NewUserForm from '../../components/NewUserForm';\nimport Main from '../Main';\nimport OrderForm from '../../components/OrderForm';\nimport { baseUrl } from '../../constants';\nimport { styled } from 'styletron-react';\nimport styles from './styles.js';\nvar MainContainer = styled('div', styles.main);\nvar Content = styled('div', styles.content);\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(App)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      error: '',\n      orders: [],\n      loggedIn: false\n    };\n\n    _this.fetchOrders = function () {\n      var token = localStorage.getItem('token');\n\n      if (token) {\n        fetch(baseUrl + '/orders', {\n          headers: {\n            Authorization: \"Bearer \".concat(token)\n          }\n        }).then(function (res) {\n          return res.json();\n        }).then(function (orders) {\n          console.log(orders);\n\n          _this.setState({\n            orders: orders\n          });\n        }).catch(function (e) {\n          return console.error(e);\n        });\n      }\n    };\n\n    _this.handleCreateUser = function (e) {\n      e.preventDefault();\n      var data = {\n        user: {\n          first_name: e.currentTarget.first_name.value,\n          last_name: e.currentTarget.last_name.value,\n          username: e.currentTarget.username.value,\n          email: e.currentTarget.email.value,\n          password: e.currentTarget.password.value\n        }\n      };\n      console.log(JSON.stringify(data));\n      fetch(baseUrl + '/users', {\n        method: 'POST',\n        body: JSON.stringify(data),\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }).then(function (response) {\n        return response.json();\n      }).then(function (newUser) {\n        if (newUser.errors) {\n          _this.displayErrors(newUser.errors);\n        } else {\n          if (newUser.success) {\n            localStorage.setItem('token', newUser.token);\n\n            _this.setState({\n              error: ''\n            });\n          }\n\n          window.history.back();\n        }\n      });\n    };\n\n    _this.displayErrors = function (errors) {\n      var errorlist = errors.map(function (error) {\n        return \"-\".concat(error, \" \\n\");\n      });\n      alert(errorlist.join(' '));\n    };\n\n    _this.handleLogin = function (e) {\n      e.preventDefault();\n      var params = {\n        username: e.currentTarget.username.value,\n        password: e.currentTarget.password.value\n      };\n\n      _this.setState({\n        error: ''\n      });\n\n      fetch(baseUrl + '/login', {\n        method: 'POST',\n        body: JSON.stringify(params),\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json'\n        }\n      }).then(function (res) {\n        return res.json();\n      }).then(function (data) {\n        console.log('TCL: App -> data', data);\n\n        if (data.success) {\n          localStorage.setItem('token', data.token);\n\n          _this.setState({\n            error: ''\n          });\n\n          window.history.back();\n        } else {\n          _this.setState({\n            error: 'Invalid username or password'\n          });\n\n          alert('Invalid username or password');\n        }\n      });\n    };\n\n    _this.handleLogout = function () {\n      localStorage.clear();\n      window.history.back();\n    };\n\n    _this.handlePlaceOrder = function (orderItems, address) {\n      var fullOrder = {\n        order: {\n          order_items: orderItems.map(function (orderItem) {\n            return {\n              pizza_type_id: orderItem.pizza_type_id,\n              quantity: orderItem.quantity\n            };\n          }),\n          date_time: new Date(),\n          address_id: address.id\n        }\n      };\n      console.log('TCL: App -> handlePlaceOrder -> fullOrder', JSON.stringify(fullOrder));\n      var token = localStorage.getItem('token');\n\n      if (token) {\n        fetch(baseUrl + '/orders', {\n          method: 'POST',\n          body: JSON.stringify(fullOrder),\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: \"Bearer \".concat(token)\n          }\n        }).then(function (res) {\n          return res.json();\n        }).then(function (orderResponse) {\n          console.log('TCL: App -> handlePlaceOrder -> orderResponse', orderResponse);\n\n          if (orderResponse.errors) {\n            alert(orderResponse.errors);\n            return;\n          } else {\n            var localOrders = _this.state.orders;\n            var updatedOrders = localOrders.push(orderResponse);\n\n            _this.setState({\n              updatedOrders: updatedOrders\n            });\n          }\n        });\n      }\n\n      _this.fetchOrders();\n    };\n\n    _this.handleCancelOrder = function () {};\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.fetchOrders();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          orders = _this$state.orders,\n          status = _this$state.status;\n      console.log(window.location.href.includes('login')); // if (\n\n      return React.createElement(MainContainer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176\n        },\n        __self: this\n      }, React.createElement(NavBar, {\n        status: status,\n        handleLogin: this.handleLogin,\n        handleLogout: this.handleLogout,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }), React.createElement(Content, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }, React.createElement(Route, {\n        exact: true,\n        path: \"/new_user\",\n        render: function render(routerProps) {\n          return React.createElement(NewUserForm, {\n            handleCreateOrEditUser: _this2.handleCreateUser,\n            displayNewUserForm: _this2.state.displayNewUserForm,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 188\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }), localStorage.getItem('token') ? null : React.createElement(Route, {\n        exact: true,\n        path: \"/login\",\n        render: function render(routerProps) {\n          return React.createElement(LoginForm, {\n            createNewUser: _this2.createNewUser,\n            handleLogin: _this2.handleLogin,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 199\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }), localStorage.getItem('token') ? React.createElement(React.Fragment, null, React.createElement(Route, {\n        exact: true,\n        path: \"/\",\n        render: function render(routerProps) {\n          return React.createElement(Main, {\n            orders: orders,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 211\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }), React.createElement(Route, {\n        path: \"/place-order\",\n        render: function render(routerProps) {\n          return React.createElement(OrderForm, {\n            handlePlaceOrder: _this2.handlePlaceOrder,\n            handleCancelOrder: _this2.handleCancelOrder,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 216\n            },\n            __self: this\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      })) : null));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/orenmagid/Development/PersonalProjects/ChroniclePizza/chronicle-pizza-frontend/src/containers/App/index.js"],"names":["React","Component","Route","NavBar","LoginForm","NewUserForm","Main","OrderForm","baseUrl","styled","styles","MainContainer","main","Content","content","App","state","error","orders","loggedIn","fetchOrders","token","localStorage","getItem","fetch","headers","Authorization","then","res","json","console","log","setState","catch","e","handleCreateUser","preventDefault","data","user","first_name","currentTarget","value","last_name","username","email","password","JSON","stringify","method","body","response","newUser","errors","displayErrors","success","setItem","window","history","back","errorlist","map","alert","join","handleLogin","params","Accept","handleLogout","clear","handlePlaceOrder","orderItems","address","fullOrder","order","order_items","orderItem","pizza_type_id","quantity","date_time","Date","address_id","id","orderResponse","localOrders","updatedOrders","push","handleCancelOrder","status","location","href","includes","routerProps","displayNewUserForm","createNewUser"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Route } from 'react-router-dom'\nimport NavBar from '../../components/Navbar'\nimport LoginForm from '../../components/LoginForm'\nimport NewUserForm from '../../components/NewUserForm'\nimport Main from '../Main'\nimport OrderForm from '../../components/OrderForm'\nimport { baseUrl } from '../../constants'\nimport { styled } from 'styletron-react'\nimport styles from './styles.js'\n\nconst MainContainer = styled('div', styles.main)\nconst Content = styled('div', styles.content)\n\nclass App extends Component {\n  state = { error: '', orders: [], loggedIn: false }\n\n  componentDidMount() {\n    this.fetchOrders()\n  }\n\n  fetchOrders = () => {\n    let token = localStorage.getItem('token')\n    if (token) {\n      fetch(baseUrl + '/orders', {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      })\n        .then(res => res.json())\n        .then(orders => {\n          console.log(orders)\n          this.setState({ orders })\n        })\n        .catch(e => console.error(e))\n    }\n  }\n\n  handleCreateUser = e => {\n    e.preventDefault()\n\n    let data = {\n      user: {\n        first_name: e.currentTarget.first_name.value,\n        last_name: e.currentTarget.last_name.value,\n        username: e.currentTarget.username.value,\n        email: e.currentTarget.email.value,\n        password: e.currentTarget.password.value\n      }\n    }\n    console.log(JSON.stringify(data))\n    fetch(baseUrl + '/users', {\n      method: 'POST',\n      body: JSON.stringify(data),\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    })\n      .then(response => response.json())\n      .then(newUser => {\n        if (newUser.errors) {\n          this.displayErrors(newUser.errors)\n        } else {\n          if (newUser.success) {\n            localStorage.setItem('token', newUser.token)\n\n            this.setState({\n              error: ''\n            })\n          }\n          window.history.back()\n        }\n      })\n  }\n\n  displayErrors = errors => {\n    let errorlist = errors.map(error => {\n      return `-${error} \\n`\n    })\n    alert(errorlist.join(' '))\n  }\n\n  handleLogin = e => {\n    e.preventDefault()\n    const params = {\n      username: e.currentTarget.username.value,\n      password: e.currentTarget.password.value\n    }\n\n    this.setState({ error: '' })\n\n    fetch(baseUrl + '/login', {\n      method: 'POST',\n      body: JSON.stringify(params),\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json'\n      }\n    })\n      .then(res => res.json())\n      .then(data => {\n        console.log('TCL: App -> data', data)\n        if (data.success) {\n          localStorage.setItem('token', data.token)\n\n          this.setState({ error: '' })\n          window.history.back()\n        } else {\n          this.setState({ error: 'Invalid username or password' })\n          alert('Invalid username or password')\n        }\n      })\n  }\n\n  handleLogout = () => {\n    localStorage.clear()\n    window.history.back()\n  }\n\n  handlePlaceOrder = (orderItems, address) => {\n    const fullOrder = {\n      order: {\n        order_items: orderItems.map(orderItem => {\n          return {\n            pizza_type_id: orderItem.pizza_type_id,\n            quantity: orderItem.quantity\n          }\n        }),\n        date_time: new Date(),\n        address_id: address.id\n      }\n    }\n    console.log(\n      'TCL: App -> handlePlaceOrder -> fullOrder',\n      JSON.stringify(fullOrder)\n    )\n\n    let token = localStorage.getItem('token')\n    if (token) {\n      fetch(baseUrl + '/orders', {\n        method: 'POST',\n        body: JSON.stringify(fullOrder),\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        }\n      })\n        .then(res => res.json())\n        .then(orderResponse => {\n          console.log(\n            'TCL: App -> handlePlaceOrder -> orderResponse',\n            orderResponse\n          )\n          if (orderResponse.errors) {\n            alert(orderResponse.errors)\n            return\n          } else {\n            const localOrders = this.state.orders\n            const updatedOrders = localOrders.push(orderResponse)\n            this.setState({ updatedOrders })\n          }\n        })\n    }\n    this.fetchOrders()\n  }\n\n  handleCancelOrder = () => {}\n\n  render() {\n    const { orders, status } = this.state\n    console.log(window.location.href.includes('login'))\n\n    // if (\n\n    return (\n      <MainContainer>\n        <NavBar\n          status={status}\n          handleLogin={this.handleLogin}\n          handleLogout={this.handleLogout}\n        />\n\n        <Content>\n          <Route\n            exact\n            path=\"/new_user\"\n            render={routerProps => (\n              <NewUserForm\n                handleCreateOrEditUser={this.handleCreateUser}\n                displayNewUserForm={this.state.displayNewUserForm}\n              />\n            )}\n          />\n          {localStorage.getItem('token') ? null : (\n            <Route\n              exact\n              path=\"/login\"\n              render={routerProps => (\n                <LoginForm\n                  createNewUser={this.createNewUser}\n                  handleLogin={this.handleLogin}\n                />\n              )}\n            />\n          )}\n          {localStorage.getItem('token') ? (\n            <>\n              <Route\n                exact\n                path=\"/\"\n                render={routerProps => <Main orders={orders} />}\n              />\n              <Route\n                path=\"/place-order\"\n                render={routerProps => (\n                  <OrderForm\n                    handlePlaceOrder={this.handlePlaceOrder}\n                    handleCancelOrder={this.handleCancelOrder}\n                  />\n                )}\n              />\n            </>\n          ) : null}\n        </Content>\n      </MainContainer>\n    )\n  }\n}\n\nexport default App\n"]},"metadata":{},"sourceType":"module"}